# Настройка Google Sheets API для экспорта статистики

## Шаг 1: Создание проекта в Google Cloud Platform

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Создайте новый проект или выберите существующий
3. Включите Google Sheets API:
   - Перейдите в "APIs & Services" > "Library"
   - Найдите "Google Sheets API"
   - Нажмите "Enable"

## Шаг 2: Создание сервисного аккаунта

1. Перейдите в "APIs & Services" > "Credentials"
2. Нажмите "Create Credentials" > "Service Account"
3. Заполните информацию:
   - **Name**: `tgbot-sheets-export`
   - **Description**: `Сервисный аккаунт для экспорта статистики в Google Sheets`
4. Нажмите "Create and Continue"
5. На втором шаге можно пропустить роли (нажать "Continue")
6. На третьем шаге нажмите "Done"

## Шаг 3: Создание ключа

1. В списке сервисных аккаунтов найдите созданный аккаунт
2. Нажмите на него
3. Перейдите во вкладку "Keys"
4. Нажмите "Add Key" > "Create new key"
5. Выберите формат "JSON"
6. Нажмите "Create"
7. Файл с ключом автоматически скачается

## Шаг 4: Настройка проекта

1. Переименуйте скачанный файл в `credentials.json`
2. Поместите файл в корневую директорию проекта
3. Скопируйте email сервисного аккаунта из файла credentials.json (поле `client_email`)

## Шаг 5: Настройка Google Sheets

1. Откройте вашу Google таблицу: https://docs.google.com/spreadsheets/d/1_zdWI24UyIe-oXS2qHQeCDtICxoCd63zU_ltQNxkaRc/edit
2. Нажмите кнопку "Поделиться" (Share)
3. Добавьте email сервисного аккаунта с правами "Редактор"
4. Снимите галочку "Уведомить пользователей"
5. Нажмите "Отправить"

## Шаг 6: Установка зависимостей

```bash
pip install google-api-python-client google-auth google-auth-oauthlib google-auth-httplib2
```

## Шаг 7: Проверка настроек

После настройки файл `.env` должен содержать:

```env
# Google Sheets интеграция
GOOGLE_SHEETS_ENABLED=true
SPREADSHEET_ID=1_zdWI24UyIe-oXS2qHQeCDtICxoCd63zU_ltQNxkaRc
GOOGLE_SHEETS_CREDENTIALS_FILE=credentials.json
```

## Возможные ошибки

### "Файл с учетными данными Google не найден"
- Убедитесь, что файл `credentials.json` находится в корне проекта
- Проверьте права доступа к файлу

### "ID таблицы Google Sheets не указан"
- Проверьте, что в `.env` файле указан правильный `SPREADSHEET_ID`

### "HTTP ошибка: 403"
- Убедитесь, что сервисный аккаунт имеет доступ к таблице
- Проверьте, что Google Sheets API включен в проекте

### "HTTP ошибка: 400"
- Проверьте формат данных
- Убедитесь, что таблица существует

## Структура экспорта

После успешной настройки в таблице будут создаваться листы:

- **Статистика_сотрудников_today** - статистика за сегодня
- **Статистика_сотрудников_week** - статистика за неделю  
- **Статистика_сотрудников_month** - статистика за месяц
- **Отчет_{ИмяСотрудника}_{период}** - детальный отчет по сотруднику

Каждый лист содержит:
- Заголовок с датой обновления
- Сводную таблицу со всеми показателями
- Итоговую строку с общими показателями

## Автоматический экспорт

Администраторы могут настроить автоматический экспорт:
- **Ежедневно** - в 23:59 каждый день
- **Еженедельно** - каждое воскресенье
- **Ежемесячно** - в последний день месяца

Для работы автоэкспорта нужно дополнительно настроить cron job или планировщик задач. 